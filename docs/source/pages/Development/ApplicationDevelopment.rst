=======================
Application Development
=======================

PoshPredictiveText is developed using Visual Studio. The majority of the code is C# with a small amount
of PowerShell scripting to register the native argument completer and remove conda tab-expansion code,
if it is installed.

Coding Standards
----------------

Itis expected that coding will following the coding standards, however, it may take some time for the conventions
used in this application to settle and code to comply with those conventions.

Coding should follow `Microsoft Coding Conventions <https://docs.microsoft.com/en-us/dotnet/csharp/fundamentals/coding-style/coding-conventions>`_.

Additional guidance provided by `Google Csharp Style Guide <https://google.github.io/styleguide/csharp-style.html>`_ is used where appropriate .

The following standards are used in the code which may conflict with the above:

- `var` should be used sparingly and only when the type is **very** obvious. Use of `var` can make
  code difficult to review if the type is not clear.
- Indentation is four spaces (no tabs).
- Don't use underscore to indicate private, protected, internal and protected internal fields. It
  adds noise.
- `const` should be in lower case, except where the value of the constant is determined by a third party
  application outside of the code. For instance, ``CONDA_BASE`` is capitalised to indicate that the value
  it contains must match that provided by a third party, and may be subject to change. The use of upper
  case is to draw attention to constant values which may generate errors if they do not match the third
  party application.
- Do not use braces for single statements where it improves readability, e.g. if statements followed by
  return to exit a method early ``if (x is null) return null;``.

Testing
-------

Testing uses Xunit, which should install from NuGet. Test coverage uses Fine Code Coverage, which is
installed as an extension in Visual Studio.

Code should be covered with reasonable unit tests to validate that it works on multiple platforms.

All tests must pass before code is accepted.

PowerShell Help Documents
-------------------------

PowerShell has traditionally used MAML XML files for console help. These are difficult to prepare by hand.
As an alternative, help files can be written in Markdown and then exported in required formats using the
PowerShell PlatyPS module.

The PlatyPS module is described on `GitHub <https://github.com/PowerShell/platyps>`_

The PlatyPS module must be downloaded and installed on the local development machine.

.. code-block:: PowerShell

   Install-Module -Name platyPS -Scope CurrentUser
   Import-Module platyPS


The base documentation is already created within the folder ``PowerShellHelpDocs``.

To create the external helpfiles run the following command whilst in the ``PowerShellHelpDocs`` folder.

.. code-block:: PowerShell
   
   New-ExternalHelp .\ -OutputPath en-US\

Source Code Documentation
-------------------------

Documentation is compiled using Sphinx to create a static website that is shared using Read The Docs.
Source documents are generated using several tools and then collated within the sphinx documentation.

1. Source code documentation is generated by Doxygen and compiled into an XML file. This file is then
   parsed by Breathe/Sphinx-csharp and added to sphinx documents. All source code should be fully 
   documented.
2. The PowerShell Help files are copied into the sphinx source directory and compiled into the sphinx
   documents.
3. The CHANGELOG.md is copied into the sphinx source directory and added to the sphinx documents.


- Doxygen: `<https://doxygen.nl/index.html>`_
- Sphinx: `<https://www.sphinx-doc.org/en/master/>`_
- Breathe: `<https://breathe.readthedocs.io/en/latest/index.html>`_
- Sphinx-csharp: `<https://github.com/rogerbarton/sphinx-csharp>`_
- Myst-parser: `<https://myst-parser.readthedocs.io/en/latest/>`_
- Sphinx RTD Theme: `<https://sphinx-rtd-theme.readthedocs.io/en/stable/>`_


1. Download and install Doxygen `<https://doxygen.nl/download.html>`_. If installing on Windows, add the
   doxygen bin folder to the path ``C:\Program Files\doxygen\bin``.

2. Create a Python environment for the Sphinx tools and install packages.

.. code-block:: python
   
   conda create -n poshpredictivetext python=3.10 sphinx sphinx_rtd_theme breathe myst-parser


3. Install Sphinx-csharp to add c# support within Sphinx/Breathe.

.. code-block:: python

    pip install git+https://github.com/rogerbarton/sphinx-csharp.git

All documentation is generated during packaging and assumes that a 'conda' environment named
``poshpredictivetext`` is configured with the required dependencies.

API Documentation
-----------------

.. toctree::
    :maxdepth: 2
    :caption: APIs
    :glob:

    API/class_*
